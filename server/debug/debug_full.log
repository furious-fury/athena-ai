--- Starting Debug Script for API Key Derivation (SAFE 1.3.0 EDITION) ---
Step 1: Setup Environment
Provider created
Step 2: Create Safe Account
[SmartWallet] Created Safe Account (1.4.1 / EP 0.6): 0x2E9A151f0fcdC87c083f5371ac9B602Da5B2Db40
SCW Address: 0x2E9A151f0fcdC87c083f5371ac9B602Da5B2Db40
Step 2b: Deploying Smart Account...
[SmartWallet] Sending userOp from 0x2E9A151f0fcdC87c083f5371ac9B602Da5B2Db40...
[SmartWallet] Transaction sent: 0xea576371ae5f9add8f6dc19e95ee7fd5066db8e6f52447a890fa25fc7751bdd6
Tx Sent: 0xea576371ae5f9add8f6dc19e95ee7fd5066db8e6f52447a890fa25fc7751bdd6. Waiting for confirmation...
Deployed!
Step 3: Initialize Signer
Signer initialized
Step 4: Attempt Derivation
Waiting 10s for RPC propagation...
Calling deriveApiKey...
[SmartAccountSigner] _signTypedData START (Safe Mode)
[SmartAccountSigner] ✨ Signing with SafeMessage wrapping for Safe
[SmartAccountSigner] Signing SafeMessage(hash)...
[ERROR] [CLOB Client] request error {"status":401,"statusText":"Unauthorized","data":{"error":"Invalid L1 Request headers"},"config":{"transitional":{"silentJSONParsing":true,"forcedJSONParsing":true,"clarifyTimeoutError":false},"transformRequest":[null],"transformResponse":[null],"timeout":0,"xsrfCookieName":"XSRF-TOKEN","xsrfHeaderName":"X-XSRF-TOKEN","maxContentLength":-1,"maxBodyLength":-1,"env":{},"headers":{"Accept":"*/*","POLY_ADDRESS":"0x2E9A151f0fcdC87c083f5371ac9B602Da5B2Db40","POLY_SIGNATURE":"0xd3c303966bd0a70b9e27c2457320c128e090e99a6116a404f160747e560ea99a3455e2ed0a15c6a65c4f648be85c6c8d60b2f9c07288c173e8f4916bf8fa947d1b","POLY_TIMESTAMP":"1765242465","POLY_NONCE":"0","User-Agent":"@polymarket/clob-client","Connection":"keep-alive","Content-Type":"application/json","Accept-Encoding":"gzip"},"method":"get","url":"https://clob.polymarket.com/auth/derive-api-key","params":{}}}
Success! Keys: { key: undefined, secret: undefined, passphrase: undefined }
Step 5: Verifying Signature On-Chain
SCW Code Length: 344
SCW Code exists.
Values for verification:
Data Hash: 0xb4313e5e30c866aa9c82476b397b95d63e5e1ca21cc5508366cb99f69a0890c8
Signing with SmartAccountSigner (SafeWrapped)...
[SmartAccountSigner] _signTypedData START (Safe Mode)
[SmartAccountSigner] ✨ Signing with SafeMessage wrapping for Safe
[SmartAccountSigner] Signing SafeMessage(hash)...
Wrapped Signature: 0xa7884c8ef11ac2a3169c426f81203b77dfe0a70b0230ab19699ac8a6f46f0c3726fbfe56312b071bd40ab02234d1ea9efee71e752e2aadf7b8e4b0cd0f0c26571c
Raw EOA Signature:    0xb3a31997a0084c095240968714f959628900d39912829932e1130a2fdb497e094b9c124a04ce8bbab2b5b3b87af141cf01f3c24dd24a251748aead933489c6261c
Calling isValidSignature on Safe 1.3.0 with Wrapped Signature...
Magic Value returned: 0x1626ba7e
SUCCESS! Safe accepts Wrapped signature.
